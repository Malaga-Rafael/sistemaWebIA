!function(){let e=[];const t="1",n="2",o="3",a="5",i=[t,n,o,"4",a],d=[t,n,o,a];async function s(t=null){try{const n="/api/ordenes",o=await fetch(n),a=await o.json();e=a.ordenes;const i=e.filter(e=>"sitio"===e.tipo_pedido),d=e.filter(e=>"domicilio"===e.tipo_pedido),s=e.filter(e=>"anticipado"===e.tipo_pedido);t&&"sitio"!==t||(p("#tabla-sitio tbody"),c(i,"#tabla-sitio tbody")),t&&"domicilio"!==t||(p("#tabla-domicilio tbody"),c(d,"#tabla-domicilio tbody")),t&&"anticipado"!==t||(p("#tabla-anticipado tbody"),c(s,"#tabla-anticipado tbody"))}catch(e){console.error("Error cargando órdenes:",e)}}function c(e,t){if(console.log(e),0===e.length){const e=document.querySelector(t),n=document.createElement("TD");return n.classList.add("no-ordenes"),n.textContent="No hay ordenes",n.colSpan=6,void e.appendChild(n)}e.forEach(e=>{const n=document.createElement("TR");n.dataset.ordenId=e.id,n.classList.add("orden");const o=document.createElement("TD");o.textContent=e.id;const a=document.createElement("TD");a.textContent=e.nombreCliente;const s=document.createElement("TD");s.textContent=e.direccionCompleta;const c=document.createElement("TD");c.classList.add("contenedor-estatus");const p=document.createElement("BUTTON");p.classList.add(`${e.nombreEstatus.toLowerCase().replace(/\s+/g,"-")}`),p.dataset.estatusOrden=e.estatusId,p.textContent=`${e.nombreEstatus}`,p.ondblclick=function(){!function(e){const{estatusId:t,tipo_pedido:n}=e,o="domicilio"===n?i:d,a=o.indexOf(t);if(-1===a||a===o.length-1)return void console.log("No se puede avanzar más el estado de esta orden.");const s=o[a+1],c={...e,estatusId:s};r(c)}({...e})};const u=document.createElement("TD");u.textContent=e.fecha_creacion;const m=document.createElement("TD");m.classList.add("opciones");const b=document.createElement("BUTTON");b.classList.add("cancelar-orden"),b.dataset.estatusOrden=e.estatusId,b.textContent="cancelar",b.ondblclick=function(){!function(e){Swal.fire({title:"¿Cancelar Orden?",showCancelButton:!0,confirmButtonText:"Si",cancelButtonText:"No"}).then(t=>{t.isConfirmed&&function(e){e.estatusId="6",r(e)}(e)})}({...e})};const f=document.createElement("BUTTON");f.classList.add("detalle-orden"),f.dataset.idOrden=e.id,f.textContent="Ver Orden",f.ondblclick=function(){!async function(e={}){try{const t=await fetch(`/api/orden?id=${e.id}`),n=await t.json(),{pago:o,productos:a}=n.respuesta,i=document.createElement("DIV");i.classList.add("modal","modal--grande"),console.log(o);let d="";null!==o&&(console.log("pago es mayor que 0"),"transferencia"===o.metodo_pago&&o.comprobante&&(d=`\n                        <a href="${o.comprobante}" target="_blank" rel="noopener noreferrer" class="ver-comprobante-btn" aria-label="Ver comprobante de pago">\n                            <i class="fa-solid fa-eye"></i>\n                        </a>\n                    `));let s="";s=a.length>0?`\n                <table class="contenedor-tabla">\n                    <thead class="encabezado-tabla">\n                        <tr>\n                            <th>Producto</th>\n                            <th>Cantidad</th>\n                            <th>Precio Unitario</th>\n                        </tr>\n                    </thead>\n                    <tbody class="cuerpo-tabla listado-ordenes">\n                        ${a.map(e=>`\n                            <tr class="producto-orden">\n                                <td>${e.nombreProducto}</td>\n                                <td>${e.cantidadProducto}</td>\n                                <td>$${parseFloat(e.precioProducto).toFixed(2)}</td>\n                            </tr>\n                        `).join("")}\n                    </tbody>\n                </table>\n            `:'<p class="sin-productos">No hay productos en esta orden.</p>';let c="";"domicilio"===e.tipo_pedido&&(c=`\n                    <div class="campo campo-direccion">\n                        <label>Dirección</label>\n                        <input type="text" value="${e.direccionCompleta}" disabled />\n                    </div>\n\n                    <div class="campo campo-referencia">\n                        <label>Referencia</label>\n                        <input type="text" value="${e.direccionReferencia}" disabled />\n                    </div>\n            `),i.innerHTML=`\n            <form class="formulario">\n                <legend>Detalle de la Orden #${e.id}</legend>\n                \n                <div class= "campos"> \n                    <div class="campo">\n                        <label>Cliente</label>\n                        <input type="text" value="${e.nombreCliente}" disabled />\n                    </div>\n\n                    <div class="campo">\n                        <label>Tipo Pedido</label>\n                        <input type="text" value="${e.tipo_pedido.charAt(0).toUpperCase()+e.tipo_pedido.slice(1)}" disabled />\n                    </div>\n\n                    <div class="campo">\n                        <label>Estatus</label>\n                        <input type="text" value="${e.nombreEstatus}" disabled />\n                    </div>\n\n                    <div class="campo campo-nota">\n                        <label>Nota</label>\n                        <input type="text" value="${e.nota||""}" disabled />\n                    </div>\n                    \n                    ${c}\n                    \n                </div> \n\n                <div class="campo">\n                        <label>Productos</label>\n                </div>\n                ${s}\n\n                <div class= "campos-pago"> \n\n                    <div class="campo">\n                            <label>Total a Pagar</label>\n                            <input type="text" value="${null===o?"0.00":o.monto}" />\n                    </div>\n\n                    <div class="campo">\n                            <label>Metodo de Pago</label>\n                            <div class="comprobante">\n                                <input type="text" value="${null===o?"Pendiente":o.metodo_pago.charAt(0).toUpperCase()+o.metodo_pago.slice(1)}" />\n                                ${d}\n                            </div>\n                    </div >\n\n                    <div class="campo">\n                        <label>Estado de Pago</label>\n                        <button \n                            type="button" \n                            class="${o.estatus}"\n                            data-id-pago = "${o.id}"\n                            >\n                                ${o.estatus.charAt(0).toUpperCase()+o.estatus.slice(1)}\n                            </button>\n                    </div>\n                </div>\n\n                <div class="opciones">\n                    <button type="button" class="cerrar-modal">Regresar</button>\n                </div>\n            </form >\n                `,setTimeout(()=>{document.querySelector(".formulario").classList.add("animar")},0),i.addEventListener("click",e=>{e.target.classList.contains("cerrar-modal")&&(document.querySelector(".formulario").classList.add("cerrar"),setTimeout(()=>i.remove(),400))}),document.querySelector(".dashboard").appendChild(i);const r=i.querySelector("button[data-id-pago]");r&&r.addEventListener("dblclick",function(){const t=this.textContent.trim().toLowerCase();console.log("Estado Actual: ",o.estatus),"pendiente"===t?Swal.fire({title:"¿Qué deseas hacer con este pago?",text:"Esta acción no se puede deshacer.",icon:"question",showCancelButton:!0,showDenyButton:!0,confirmButtonText:"Confirmar",denyButtonText:"Rechazar",cancelButtonText:"Cancelar",reverseButtons:!0}).then(t=>{if(t.isConfirmed)o.estatus="confirmado",l({...e},{...o});else{if(!t.isDenied)return;o.estatus="rechazado",l({...e},{...o})}}):Swal.fire("Acción no disponible","Solo se puede confirmar o rechazar pagos pendientes.","warning")})}catch(e){console.error("Error al cargar detalle de orden:",e)}}({...e})},m.appendChild(f),m.appendChild(b),c.appendChild(p),n.appendChild(o),n.appendChild(a),"domicilio"===e.tipo_pedido&&n.appendChild(s),n.appendChild(c),n.appendChild(u),n.appendChild(m);document.querySelector(t).appendChild(n)})}async function l(e,t){const n=new FormData;n.append("id",t.id),n.append("estatus",t.estatus);try{const e="/api/pago/actualizar",o=await fetch(e,{method:"POST",body:n}),a=await o.json();if("exito"===a.tipo){Swal.fire(a.mensaje,"","success");const e=document.querySelector(`button[data-id-pago="${t.id}"]`);e&&(e.textContent=t.estatus.charAt(0).toUpperCase()+t.estatus.slice(1),e.className=t.estatus)}}catch(e){console.log(e)}}async function r(t){const n=new FormData;n.append("id",t.id),n.append("estatusId",t.estatusId);try{const o="/api/orden/actualizar",a=await fetch(o,{method:"POST",body:n}),i=await a.json();if("exito"===i.respuesta.tipo){Swal.fire(i.respuesta.mensaje,"","success"),e=e.map(e=>(e.id===t.id&&(e.estatusId=t.estatusId),e));s(t.tipo_pedido)}}catch(e){console.log(e)}}function p(e){const t=document.querySelector(e);for(;t.firstChild;)t.removeChild(t.firstChild)}s(),window.actualizarOrdenEnTiempoReal=function(t){const n=t.client?`${t.client.name} ${t.client.lastname||""} `.trim():"Cliente",o=t.address?`${t.address.address||""} `.trim():"",a={id:t.id,nombreCliente:n,direccionCompleta:o,nombreEstatus:t.status?.name,estatusId:t.status?.id?.toString(),fecha_creacion:t.created_at||(new Date).toISOString(),tipo_pedido:t.order.type,nota:t.order.note||"",clienteId:t.client?.id||null,restauranteId:t.restaurant?.id||null};console.log("Orden Recibida por el socket: ",t),console.log("ORDEN NORMALIZADA: ",a);const i=e.findIndex(e=>e.id===a.id);i>=0?e[i]=a:e.push(a);const d=a.tipo_pedido;if("sitio"===d){p("#tabla-sitio tbody");c(e.filter(e=>"sitio"===e.tipo_pedido),"#tabla-sitio tbody")}else if("domicilio"===d){p("#tabla-domicilio tbody");c(e.filter(e=>"domicilio"===e.tipo_pedido),"#tabla-domicilio tbody")}else if("anticipado"===d){p("#tabla-anticipado tbody");c(e.filter(e=>"anticipado"===e.tipo_pedido),"#tabla-anticipado tbody")}}}();