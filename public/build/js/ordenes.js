!function(){let e=[];async function t(t=null){try{const a="/api/ordenes",d=await fetch(a),i=await d.json();e=i.ordenes;const c=e.filter(e=>"sitio"===e.tipo_pedido),l=e.filter(e=>"domicilio"===e.tipo_pedido),s=e.filter(e=>"anticipado"===e.tipo_pedido);t&&"sitio"!==t||(o("#tabla-sitio tbody"),n(c,"#tabla-sitio tbody")),t&&"domicilio"!==t||(o("#tabla-domicilio tbody"),n(l,"#tabla-domicilio tbody")),t&&"anticipado"!==t||(o("#tabla-anticipado tbody"),n(s,"#tabla-anticipado tbody"))}catch(e){console.error("Error cargando órdenes:",e)}}function n(e,t){if(console.log(e),0===e.length){const e=document.querySelector(t),n=document.createElement("TD");return n.classList.add("no-ordenes"),n.textContent="No hay ordenes",n.colSpan=4,void e.appendChild(n)}e.forEach(e=>{const n=document.createElement("TR");DataTransferItem.ordenId=e.id,n.classList.add("orden");const o=document.createElement("TD");o.textContent=e.id;const d=document.createElement("TD");d.textContent=e.nombreCliente;const i=document.createElement("TD");i.textContent=e.direccionCompleta;const c=document.createElement("TD");c.textContent=e.nombreEstatus;const l=document.createElement("TD");l.textContent=e.fecha_creacion;const s=document.createElement("TD");s.classList.add("opciones");const r=document.createElement("BUTTON");r.classList.add("cancelar-orden"),r.dataset.estatusOrden=e.estatusId,r.textContent="cancelar",r.ondblclick=function(){!function(e){Swal.fire({title:"¿Cancelar Orden?",showCancelButton:!0,confirmButtonText:"Si",cancelButtonText:"No"}).then(t=>{t.isConfirmed&&function(e){e.estatusId="6",a(e)}(e)})}({...e})};const p=document.createElement("BUTTON");p.classList.add("detalle-orden"),p.dataset.idOrden=e.Id,p.textContent="Ver Orden",p.ondblclick=function(){!async function(e={}){try{const t=await fetch(`/api/orden?id=${e.id}`),n=await t.json(),{productos:a}=n,o=document.createElement("DIV");o.classList.add("modal","modal--grande");let d="";d=a.length>0?`\n                <table class="contenedor-tabla">\n                    <thead class="encabezado-tabla">\n                        <tr>\n                            <th>Producto</th>\n                            <th>Cantidad</th>\n                            <th>Precio Unitario</th>\n                        </tr>\n                    </thead>\n                    <tbody class="cuerpo-tabla listado-ordenes">\n                        ${a.map(e=>`\n                            <tr class="producto-orden">\n                                <td>${e.nombreProducto}</td>\n                                <td>${e.cantidadProducto}</td>\n                                <td>$${parseFloat(e.precioProducto).toFixed(2)}</td>\n                            </tr>\n                        `).join("")}\n                    </tbody>\n                </table>\n            `:'<p class="sin-productos">No hay productos en esta orden.</p>';let i="";"sitio"!==e.tipo_pedido&&(i=`\n                    <div class="campo campo-direccion">\n                        <label>Dirección</label>\n                        <input type="text" value="${e.direccionCompleta}" disabled />\n                    </div>\n\n                    <div class="campo campo-referencia">\n                        <label>Referencia</label>\n                        <input type="text" value="${e.direccionReferencia}" disabled />\n                    </div>\n            `),o.innerHTML=`\n            <form class="formulario">\n                <legend>Detalle de la Orden #${e.id}</legend>\n                <div class= "campos"> \n                    <div class="campo">\n                        <label>Tipo Pedido</label>\n                        <input type="text" value="${e.tipo_pedido}" disabled />\n                    </div>\n\n                    <div class="campo">\n                        <label>Estatus</label>\n                        <input type="text" value="${e.nombreEstatus}" disabled />\n                    </div>\n\n                    <div class="campo">\n                        <label>Cliente</label>\n                        <input type="text" value="${e.nombreCliente}" disabled />\n                    </div>\n\n                    <div class="campo campo-nota">\n                        <label>Nota</label>\n                        <input type="text" value="${e.nota||""}" disabled />\n                    </div>\n                    \n                    ${i}\n                    \n                </div> \n\n                <div class="campo">\n                        <label>Productos</label>\n                </div>\n                ${d}\n\n                <div class="opciones">\n                    <button type="button" class="cerrar-modal">Regresar</button>\n                </div>\n            </form>\n        `,setTimeout(()=>{document.querySelector(".formulario").classList.add("animar")},0),o.addEventListener("click",e=>{e.target.classList.contains("cerrar-modal")&&(document.querySelector(".formulario").classList.add("cerrar"),setTimeout(()=>o.remove(),400))}),document.querySelector(".dashboard").appendChild(o)}catch(e){console.error("Error al cargar detalle de orden:",e)}}({...e})},s.appendChild(p),s.appendChild(r),n.appendChild(o),n.appendChild(d),"sitio"!==e.tipo_pedido&&n.appendChild(i),n.appendChild(c),n.appendChild(l),n.appendChild(s);document.querySelector(t).appendChild(n)})}async function a(n){const{id:a,fecha_creacion:o,tipo_pedido:d,nota:i,clienteId:c,restauranteId:l,estatusId:s,direccionId:r}=n,p=new FormData;p.append("id",a),p.append("fecha_creacion",o),p.append("tipo_pedido",d),p.append("nota",i),p.append("clienteId",c),p.append("restauranteId",l),p.append("estatusId",s),p.append("direccionId",r||""),console.log(n);try{const d="http://localhost:3000/api/orden/actualizar",i=await fetch(d,{method:"POST",body:p}),l=await i.json();if(console.log(l),"exito"===l.respuesta.tipo){Swal.fire(l.respuesta.mensaje,"","success"),e=e.map(e=>(e.id===a&&(e.fecha_creacion=o,e.clienteId=c,e.estatusId=s),e));t(n.tipo_pedido)}}catch(e){console.log(e)}}function o(e){const t=document.querySelector(e);for(;t.firstChild;)t.removeChild(t.firstChild)}t()}();