!function(){!async function(){try{const t=`/api/productos?id=${a()}`,o=await fetch(t),i=await o.json();e=i.productos||[],n()}catch(e){console.log(e)}}();let e=[];const t=document.querySelector("#agregar-producto");function n(){if(function(){const e=document.querySelector("#listado-productos");for(;e?.firstChild;)e.removeChild(e.firstChild)}(),0===e.length){const e=document.querySelector("#listado-productos"),t=document.createElement("LI");return t.textContent="No hay productos",t.classList.add("no-productos"),void e.appendChild(t)}const t={0:"Indisponible",1:"Disponible"};e.forEach(i=>{const r=document.createElement("LI");r.classList.add("producto");const d=document.createElement("P");d.textContent=i.nombre,d.ondblclick=()=>o(!0,{...i});const l=document.createElement("DIV");l.classList.add("opciones");const s=document.createElement("BUTTON");s.classList.add("disponible-producto",t[i.disponible].toLowerCase()),s.textContent=t[i.disponible],s.ondblclick=()=>function(e){const t="1"===e.disponible?"0":"1";e.disponible=t,c(e)}({...i});const u=document.createElement("BUTTON");u.classList.add("eliminar-producto"),u.dataset.idProducto=i.id,u.textContent="Eliminar",u.ondblclick=()=>function(t){Swal.fire({title:"¿Eliminar Producto?",showCancelButton:!0,confirmButtonText:"Sí",cancelButtonText:"No"}).then(o=>{o.isConfirmed&&async function(t){const o=new FormData;o.append("id",t.id),o.append("categoriaId",a());try{const i="/api/producto/eliminar",c=await fetch(i,{method:"POST",body:o}),a=await c.json();a.resultado&&(Swal.fire("Eliminado",a.mensaje,"success"),e=e.filter(e=>e.id!==t.id),n())}catch(e){console.log(e)}}(t)})}({...i}),l.appendChild(s),l.appendChild(u),r.appendChild(d),r.appendChild(l),document.querySelector("#listado-productos")?.appendChild(r)})}function o(t=!1,o={}){const r=document.createElement("DIV");if(r.classList.add("modal"),r.innerHTML=`\n            <form class="formulario nuevo-producto">\n                <legend>${t?"Editar Producto":"Añade un nuevo producto"}</legend>\n                <div class="campo">\n                    <label>Producto</label>\n                    <input type="text" name="producto" id="producto" value="${o.nombre||""}" required />\n                </div>\n                <div class="campo">\n                    <label>Descripción</label>\n                    <input type="text" name="descripcion" id="descripcion" value="${o.descripcion||""}" />\n                </div>\n                <div class="campo">\n                    <label for="imagen1">Imagen 1</label>\n                    <input type="file" id="imagen1" accept="image/jpeg, image/png" />\n                </div>\n                <div class="campo">\n                    <label for="imagen2">Imagen 2</label>\n                    <input type="file" id="imagen2" accept="image/jpeg, image/png" />\n                </div>\n                <div class="opciones">\n                    <input type="submit" class="submit-nuevo-producto" value="${t?"Guardar Cambios":"Añadir Producto"}" />\n                    <button type="button" class="cerrar-modal">Cancelar</button>\n                </div>\n            </form>\n        `,t){const e=r.querySelector('[for="imagen1"]').parentElement,t=r.querySelector('[for="imagen2"]').parentElement;if(o.imagen1){const t=document.createElement("img");t.src=`${SUPABASE_URL}/storage/v1/object/public/${SUPABASE_BUCKET}/${o.imagen1}`,t.style.width="100px",t.style.marginTop="10px",e.appendChild(t)}if(o.imagen2){const e=document.createElement("img");e.src=`${SUPABASE_URL}/storage/v1/object/public/${SUPABASE_BUCKET}/${o.imagen2}`,e.style.width="100px",e.style.marginTop="10px",t.appendChild(e)}}setTimeout(()=>{const e=r.querySelector(".formulario");e&&e.classList.add("animar")},0),r.addEventListener("click",function(d){if(d.target.classList.contains("cerrar-modal")){d.preventDefault();const e=r.querySelector(".formulario");return void(e&&(e.classList.add("cerrar"),setTimeout(()=>r.remove(),400)))}if(d.target.classList.contains("submit-nuevo-producto")){d.preventDefault();const l=document.querySelector("#producto").value.trim(),s=document.querySelector("#descripcion").value.trim();if(!l)return void i("El nombre del producto es obligatorio","error",r.querySelector("legend"));t?(o.nombre=l,o.descripcion=s,c(o)):async function(t,o){const c=new FormData;c.append("nombre",t),c.append("descripcion",o),c.append("categoriaId",a());const r=document.querySelector("#imagen1").files[0],d=document.querySelector("#imagen2").files[0];r&&c.append("imagen1",r);d&&c.append("imagen2",d);try{const a="/api/producto",r=await fetch(a,{method:"POST",body:c}),d=await r.json();if(i(d.mensaje,d.tipo,document.querySelector(".modal legend")),"exito"===d.tipo){document.querySelector("#producto").value="",document.querySelector("#descripcion").value="";const i={id:String(d.id),nombre:t,descripcion:o,disponible:"1",imagen1:d.imagen1||null,imagen2:d.imagen2||null,categoriaId:d.categoriaId};e.push(i),n(),document.querySelector(".modal .cerrar-modal")?.click()}}catch(e){console.log(e)}}(l,s)}}),document.querySelector(".dashboard")?.appendChild(r)}function i(e,t,n){const o=document.querySelector(".alerta");o&&o.remove();const i=document.createElement("DIV");i.classList.add("alerta",t),i.textContent=e,n?.parentElement?.insertBefore(i,n.nextElementSibling),setTimeout(()=>i.remove(),5e3)}async function c(t){const o=new FormData;o.append("id",t.id),o.append("nombre",t.nombre),o.append("descripcion",t.descripcion),o.append("categoriaId",a()),o.append("disponible",t.disponible);const c=document.querySelector("#imagen1"),r=document.querySelector("#imagen2");c?.files[0]&&o.append("imagen1",c.files[0]),r?.files[0]&&o.append("imagen2",r.files[0]);try{const c="/api/producto/actualizar",a=await fetch(c,{method:"POST",body:o}),r=await a.json();"exito"===r.respuesta?.tipo?(Swal.fire("Éxito",r.respuesta.mensaje,"success"),e=e.map(e=>e.id===t.id?{...e,nombre:t.nombre,descripcion:t.descripcion,disponible:t.disponible,imagen1:r.respuesta.imagen1??e.imagen1,imagen2:r.respuesta.imagen2??e.imagen2}:e),document.querySelector(".modal .cerrar-modal")?.click(),n()):i(r.respuesta?.mensaje||"Error al actualizar","error",document.querySelector(".modal legend"))}catch(e){console.log(e),i("Error de conexión","error",document.querySelector(".modal legend"))}}function a(){return new URLSearchParams(window.location.search).get("id")}t&&t.addEventListener("click",function(){o()})}();