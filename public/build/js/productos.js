!function(){!async function(){try{const n=`/api/productos?id=${a()}`,t=await fetch(n),i=await t.json();e=i.productos||[],console.log(i.productos),o()}catch(e){console.log(e)}}();let e=[];const n=document.querySelector("#agregar-producto");function o(){if(function(){const e=document.querySelector("#listado-productos");for(;e?.firstChild;)e.removeChild(e.firstChild)}(),0===e.length){const e=document.querySelector("#listado-productos"),n=document.createElement("LI");return n.textContent="No hay productos",n.classList.add("no-productos"),void e.appendChild(n)}const n={0:"Indisponible",1:"Disponible"};e.forEach(i=>{const r=document.createElement("LI");r.classList.add("producto");const d=document.createElement("P");d.textContent=i.nombre,d.ondblclick=()=>t(!0,{...i});const l=document.createElement("P");l.textContent=`$ ${i.precio}`;const s=document.createElement("DIV");s.classList.add("opciones");const p=document.createElement("BUTTON");p.classList.add("disponible-producto",n[i.disponible].toLowerCase()),p.textContent=n[i.disponible],p.ondblclick=()=>function(e){const n="1"===e.disponible?"0":"1";e.disponible=n,c(e)}({...i});const u=document.createElement("BUTTON");u.classList.add("eliminar-producto"),u.dataset.idProducto=i.id,u.textContent="Eliminar",u.ondblclick=()=>function(n){Swal.fire({title:"¿Eliminar Producto?",showCancelButton:!0,confirmButtonText:"Sí",cancelButtonText:"No"}).then(t=>{t.isConfirmed&&async function(n){const t=new FormData;t.append("id",n.id),t.append("categoriaId",a());try{const i="/api/producto/eliminar",c=await fetch(i,{method:"POST",body:t}),a=await c.json();a.resultado&&(Swal.fire("Eliminado",a.mensaje,"success"),e=e.filter(e=>e.id!==n.id),o())}catch(e){console.log(e)}}(n)})}({...i}),s.appendChild(p),s.appendChild(u),r.appendChild(d),r.appendChild(l),r.appendChild(s),document.querySelector("#listado-productos")?.appendChild(r)})}function t(n=!1,t={}){const d=document.createElement("DIV");if(d.classList.add("modal"),d.innerHTML=`\n            <form class="formulario nuevo-producto">\n                <legend>${n?"Editar Producto":"Añade un nuevo producto"}</legend>\n                <div class="campo">\n                    <label>Producto</label>\n                    <input \n                        type="text" \n                        name="producto" \n                        placeholder="${t.nombre?"Editar Producto":"Añadir producto a la categoría actual"}"\n                        id="producto" \n                        value="${t.nombre?t.nombre:""}"\n                    />\n                </div>\n                <div class="campo">\n                    <label>Descripción</label>\n                    <input\n                        type="text"\n                        name="descripcion"\n                        placeholder="${t.nombre?"Editar descripción":"Añadir una descripción al producto"}"\n                        id="descripcion"\n                        value="${t.descripcion?t.descripcion:""}"\n                    />\n                </div>\n                <div class="campo">\n                    <label>Precio</label>\n                    <input\n                        type="text"\n                        name="precio"\n                        placeholder="${t.precio?"Editar precio":"Añadir un precio al producto"}"\n                        id="precio"\n                        value="${t.precio?t.precio:""}"\n                    / >\n                </div>\n\n                <div class="subir-imagen">\n                    <div class="campo imagen">\n                        <input type="file" id="imagen1" accept="image/jpeg, image/png" />\n                        <label class="btn-imagen" for="imagen1">Imagen 1</label>\n                    </div>\n                    <div class="campo imagen">\n                        <input type="file" id="imagen2" accept="image/jpeg, image/png" />\n                        <label class="btn-imagen" for="imagen2">Imagen 2</label>\n                    </div>\n                </div>\n                \n\n                <div class="opciones">\n                    <input \n                        type="submit" \n                        class="submit-nuevo-producto" \n                        value="${n?"Guardar Cambios":"Añadir Producto"}" \n                    />\n                    <button type="button" class="cerrar-modal">Cancelar</button>\n                </div>\n            </form>\n        `,n){const e=d.querySelector('[for="imagen1"]').parentElement,n=d.querySelector('[for="imagen2"]').parentElement;if(t.imagen1){const n=document.createElement("img");n.classList.add("preview-img"),n.src=t.imagen1,n.style.width="80px",n.style.marginTop="5px",e.appendChild(n)}if(t.imagen2){const e=document.createElement("img");e.classList.add("preview-img"),e.src=t.imagen2,e.style.width="80px",e.style.marginTop="5px",n.appendChild(e)}}setTimeout(()=>{const e=d.querySelector(".formulario");e&&e.classList.add("animar")},0),d.addEventListener("click",function(r){if(r.target.classList.contains("cerrar-modal")){r.preventDefault();const e=d.querySelector(".formulario");return void(e&&(e.classList.add("cerrar"),setTimeout(()=>d.remove(),400)))}if(r.target.classList.contains("submit-nuevo-producto")){r.preventDefault();const l=document.querySelector("#producto").value.trim(),s=document.querySelector("#descripcion").value.trim(),p=document.querySelector("#precio").value.trim();if(!l)return void i("El nombre del producto es obligatorio","error",d.querySelector("legend"));n?(t.nombre=l,t.descripcion=s,t.precio=p,c(t)):async function(n,t,c){const r=new FormData;r.append("nombre",n),r.append("descripcion",t),r.append("precio",c),r.append("categoriaId",a());const d=document.querySelector("#imagen1").files[0],l=document.querySelector("#imagen2").files[0];d&&r.append("imagen1",d);l&&r.append("imagen2",l);try{const a="/api/producto",d=await fetch(a,{method:"POST",body:r}),l=await d.json();if(i(l.mensaje,l.tipo,document.querySelector(".modal legend")),"exito"===l.tipo){document.querySelector("#producto").value="",document.querySelector("#descripcion").value="",document.querySelector("#precio").value="";const i={id:String(l.id),nombre:n,descripcion:t,precio:c,disponible:"1",imagen1:l.imagen1||null,imagen2:l.imagen2||null,categoriaId:l.categoriaId};e.push(i),o(),document.querySelector(".modal .cerrar-modal")?.click()}}catch(e){console.log(e)}}(l,s,p)}}),document.querySelector(".dashboard")?.appendChild(d),r(d,"imagen1"),r(d,"imagen2")}function i(e,n,o){const t=document.querySelector(".alerta");t&&t.remove();const i=document.createElement("DIV");i.classList.add("alerta",n),i.textContent=e,o.parentElement.insertBefore(i,o.nextElementSibling),setTimeout(()=>{i.remove()},5e3)}async function c(n){const t=new FormData;t.append("id",n.id),t.append("nombre",n.nombre),t.append("descripcion",n.descripcion),t.append("precio",n.precio),t.append("categoriaId",a()),t.append("disponible",n.disponible);const c=document.querySelector("#imagen1"),r=document.querySelector("#imagen2");c?.files[0]&&t.append("imagen1",c.files[0]),r?.files[0]&&t.append("imagen2",r.files[0]);try{const c="/api/producto/actualizar",a=await fetch(c,{method:"POST",body:t}),r=await a.json();"exito"===r.respuesta?.tipo?(Swal.fire("Éxito",r.respuesta.mensaje,"success"),e=e.map(e=>e.id===n.id?{...e,nombre:n.nombre,descripcion:n.descripcion,precio:n.precio,disponible:n.disponible,imagen1:r.respuesta.imagen1??e.imagen1,imagen2:r.respuesta.imagen2??e.imagen2}:e),document.querySelector(".modal .cerrar-modal")?.click(),o()):i(r.respuesta?.mensaje||"Error al actualizar","error",document.querySelector(".modal legend"))}catch(e){console.log(e),i("Error de conexión","error",document.querySelector(".modal legend"))}}function a(){return new URLSearchParams(window.location.search).get("id")}function r(e,n){const o=e.querySelector(`#${n}`);o?o.addEventListener("change",function(e){const n=e.target.files[0],t=o.closest(".campo");if(!t)return void console.error("Contenedor .campo no encontrado");const i=t.querySelector(".preview-img");if(i&&i.remove(),n){const e=new FileReader;e.onload=function(e){const n=document.createElement("img");n.src=e.target.result,n.classList.add("preview-img"),t.appendChild(n)},e.readAsDataURL(n)}}):console.warn(`Input ${n} no encontrado`)}n&&n.addEventListener("click",function(){t()})}();