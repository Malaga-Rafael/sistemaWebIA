!function(){!async function(){try{const n=`/api/productos?id=${a()}`,t=await fetch(n),c=await t.json();e=c.productos,console.log(c),o()}catch(e){console.log(e)}}();let e=[];function o(){if(function(){const e=document.querySelector("#listado-productos");for(;e.firstChild;)e.removeChild(e.firstChild)}(),0===e.length){const e=document.querySelector("#listado-productos"),o=document.createElement("LI");return o.textContent="No hay productos",o.classList.add("no-productos"),void e.appendChild(o)}const t={0:"Indisponible",1:"Disponible"};e.forEach(i=>{const r=document.createElement("LI");DataTransferItem.productoId=i.id,r.classList.add("producto");const d=document.createElement("P");d.textContent=i.nombre,d.ondblclick=function(){n(!0,{...i})};const s=document.createElement("DIV");s.classList.add("opciones");const l=document.createElement("BUTTON");l.classList.add("disponible-producto"),l.classList.add(`${t[i.disponible].toLowerCase()}`),l.textContent=t[i.disponible],l.dataset.disponibleProducto=i.disponible,l.ondblclick=function(){!function(e){const o="1"===e.disponible?"0":"1";e.disponible=o,c(e)}({...i})};const p=document.createElement("BUTTON");p.classList.add("eliminar-producto"),p.dataset.idProducto=i.id,p.textContent="Eliminar",p.ondblclick=function(){!function(n){Swal.fire({title:"¿Eliminar Producto?",showCancelButton:!0,confirmButtonText:"Si",cancelButtonText:"No"}).then(t=>{t.isConfirmed&&async function(n){const{disponible:t,id:c,nombre:i,descripcion:r,imagen_url:d,precio:s,fecha_creacion:l,fecha_actualizacion:p}=n,u=new FormData;u.append("id",c),u.append("nombre",i),u.append("descripcion",r),u.append("precio",s),u.append("imagen_url",d),u.append("disponible",t),u.append("fecha_creacion",l),u.append("fecha_actualizacion",p),u.append("categoriaId",a());try{const t="http://localhost:3000/api/producto/eliminar",c=await fetch(t,{method:"POST",body:u}),a=await c.json();a.resultado&&(Swal.fire("Eliminado",a.mensaje,"success"),e=e.filter(e=>e.id!==n.id),o())}catch(e){console.log(e)}}(n)})}({...i})},s.appendChild(l),s.appendChild(p),r.appendChild(d),r.appendChild(s);document.querySelector("#listado-productos").appendChild(r)})}function n(n=!1,i={}){const r=document.createElement("DIV");r.classList.add("modal"),r.innerHTML=`\n            <form class="formulario nuevo-producto">\n                <legend>${n?"Editar Producto":"Añade un nuevo producto"}</legend>\n                <div class="campo">\n                    <label>Producto</label>\n                    <input\n                        type="text"\n                        name="producto"\n                        placeholder="${i.nombre?"Editar Producto":"Añadir producto a la categoría actual"}"\n                        id="producto"\n                        value="${i.nombre?i.nombre:""}"\n                    />\n                </div>\n                <div class="campo">\n                    <label>Descripcion</label>\n                    <input\n                        type="text"\n                        name="descripcion"\n                        placeholder="${i.nombre?"Editar descripción":"Añadir una descripción al producto"}"\n                        id="descripcion"\n                        value="${i.descripcion?i.descripcion:""}"\n                    />\n                </div>\n\n                <div class="campo">\n                    <label for="imagen1">Imagen</label>\n                    <input \n                        type="file"\n                        id="imagen1"\n                        accept="image/jpeg, image/png" \n                    />\n                </div>\n\n                <div class="campo">\n                    <label for="imagen2">Imagen</label>\n                    <input \n                        type="file" \n                        id="imagen2"\n                        accept="image/jpeg, image/png" \n                    />\n                </div>\n                <div class="opciones">\n                    <input \n                        type="submit" \n                        class="submit-nuevo-producto" \n                        value="${i.nombre?"Guardar Cambios":"Añadir Producto"}" />\n                    <button type="button" class="cerrar-modal">Cancelar</button>\n                </div>\n            </form>\n        `,setTimeout(()=>{document.querySelector(".formulario").classList.add("animar")},0),r.addEventListener("click",function(d){if(d.preventDefault(),d.target.classList.contains("cerrar-modal")){document.querySelector(".formulario").classList.add("cerrar"),setTimeout(()=>{r.remove()},400)}if(d.target.classList.contains("submit-nuevo-producto")){const r=document.querySelector("#producto").value.trim(),d=document.querySelector("#descripcion").value.trim();if(""===r)return void t("El nombre del producto es obligatorio","error",document.querySelector(".formulario legend"));n?(i.nombre=r,i.descripcion=d,c(i)):async function(n,c){const i=new FormData;i.append("nombre",n),i.append("descripcion",c),i.append("categoriaId",a());try{const a="http://localhost:3000/api/producto",r=await fetch(a,{method:"POST",body:i}),d=await r.json();if(t(d.mensaje,d.tipo,document.querySelector(".formulario legend")),"exito"===d.tipo){const t=document.querySelector("#producto");t.value="",t.focus();document.querySelector("#descripcion").value="";const a={id:String(d.id),nombre:n,descripcion:c,precio:"0.00",imagen1:"",imagen2:"",disponible:"1",fecha_creacion:d.fecha_creacion,fecha_actualizacion:d.fecha_actualizacion,categoriaId:d.categoriaId};"undefined"!=typeof socket&&socket.emit("producto_nuevo",a),e=[...e,a],o()}}catch(e){console.log(e)}}(r,d)}}),document.querySelector(".dashboard").appendChild(r)}function t(e,o,n){const t=document.querySelector(".alerta");t&&t.remove();const c=document.createElement("DIV");c.classList.add("alerta",o),c.textContent=e,n.parentElement.insertBefore(c,n.nextElementSibling),setTimeout(()=>{c.remove()},5e3)}async function c(n){const{disponible:t,id:c,nombre:i,descripcion:r,imagen_url:d,precio:s,categoriaId:l,fecha_creacion:p,fecha_actualizacion:u}=n;console.log(n);const m=new FormData;m.append("id",c),m.append("nombre",i),m.append("descripcion",r),m.append("precio",s),m.append("imagen_url",d),m.append("disponible",t),m.append("fecha_creacion",p),m.append("fecha_actualizacion",u),m.append("categoriaId",a());try{const n="http://localhost:3000/api/producto/actualizar",a=await fetch(n,{method:"POST",body:m}),d=await a.json();if("exito"===d.respuesta.tipo){Swal.fire(d.respuesta.mensaje,d.respuesta.mensaje,"success");const n=document.querySelector(".modal");n&&n.remove(),e=e.map(e=>(e.id===c&&(e.disponible=t,e.nombre=i,e.descripcion=r),e)),o()}}catch(e){console.log(e)}}function a(){const e=new URLSearchParams(window.location.search);return Object.fromEntries(e.entries()).id}document.querySelector("#agregar-producto").addEventListener("click",function(){n()})}();